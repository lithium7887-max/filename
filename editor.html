<!DOCTYPE html>
<html lang="ko" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="google" content="notranslate">
    <title>ë‚˜ë§Œì˜ ê³ í™”ì§ˆ ì›¹ ì‚¬ì§„ í¸ì§‘ íˆ´ ğŸ¨</title>

    <script src="https://unpkg.com/fabric@5.3.0/dist/fabric.min.js"></script>
    
    <style>
        body { font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; background-color: #f0f2f5; text-align: center; padding: 0; margin: 0; color: #333; }
        
        /* ì œëª©ì— ìœ„ìª½ ì—¬ë°± ì¶”ê°€ (ìƒë‹¨ ë©”ë‰´ë°”ì™€ ê²¹ì¹˜ì§€ ì•Šë„ë¡) */
        h2 { margin-top: 30px; margin-bottom: 25px; }

        /* [í•µì‹¬ ìˆ˜ì •] UI ìš”ì†Œë“¤ì˜ ë„ˆë¹„ë¥¼ í†µì¼í•˜ê³  ì¤‘ì•™ ì •ë ¬í•˜ê¸° ìœ„í•œ ì»¨í…Œì´ë„ˆ */
        .ui-wrapper {
            display: block;
            width: 95%;           /* ëª¨ë°”ì¼ ë“± ì‘ì€ í™”ë©´ì—ì„œëŠ” ê½‰ ì°¨ê²Œ */
            max-width: 1050px;    /* ë„ˆë¬´ ë„“ì–´ì§€ì§€ ì•Šê²Œ ìµœëŒ€ ë„ˆë¹„ ì œí•œ (íˆ´ë°” ë²„íŠ¼ë“¤ì´ ë”± ë“¤ì–´ê°ˆ ì •ë„) */
            margin: 0 auto 15px;  /* ì¤‘ì•™ ì •ë ¬ ë° ì•„ë˜ìª½ ì—¬ë°± */
        }

        /* íˆ´ë°” ìŠ¤íƒ€ì¼ (inline-block ì œê±°í•˜ê³  ë„ˆë¹„ 100%ë¡œ ì„¤ì •) */
        .toolbar { 
            padding: 20px; 
            background: white; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); 
            width: 100%; 
            box-sizing: border-box; /* paddingì´ ë„ˆë¹„ì— í¬í•¨ë˜ë„ë¡ ì„¤ì • */
        }
        
        .button-group { margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee; }
        .control-group { background: #f8f9fa; padding: 8px 15px; border-radius: 6px; display: inline-block; border: 1px solid #e9ecef; margin: 5px; vertical-align: middle; }
        
        /* ë²„íŠ¼ ë° ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ ë‹¤ë“¬ê¸° */
        button, input[type="file"], select { 
            padding: 10px 18px; 
            margin: 4px; 
            cursor: pointer; 
            font-size: 14px; 
            border: 1px solid #ddd; 
            border-radius: 6px; 
            background-color: #fff; 
            transition: all 0.2s; 
            vertical-align: middle; 
            font-weight: 500;
            color: #555;
        }
        button:hover, select:hover { background-color: #f1f3f5; border-color: #ccc; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        
        /* ì£¼ìš” ë²„íŠ¼ ìƒ‰ìƒ í¬ì¸íŠ¸ */
        #btnSave { background-color: #28a745; color: white; border: none; }
        #btnSave:hover { background-color: #218838; box-shadow: 0 4px 6px rgba(40, 167, 69, 0.2); }
        #btnSticker { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        #btnSticker:hover { background-color: #ffe8a1; }
        #btnDelete { color: #dc3545; border-color: #dc3545; }
        #btnDelete:hover { background-color: #dc3545; color: white; }

        input[type="color"] { padding: 2px 4px; height: 34px; }
        input[type="range"] { vertical-align: middle; cursor: pointer; }
        
        /* ìº”ë²„ìŠ¤ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .canvas-container-wrapper { width: 100%; max-width: 100%; overflow: auto; margin-top: 25px; display: flex; justify-content: center; padding-bottom: 20px; }
        .canvas-container { box-shadow: 0 8px 30px rgba(0,0,0,0.15); background-color: white; border-radius: 4px; }
        
        /* ì„¤ëª…ì°½ ìŠ¤íƒ€ì¼ (inline-block ì œê±°, ë„ˆë¹„ 100% ì„¤ì •) */
        .help-text { 
            background: #e7f5ff; 
            color: #004085; 
            padding: 15px 20px; 
            border-radius: 10px; 
            font-size: 14px; 
            text-align: left; 
            line-height: 1.7; 
            border: 1px solid #b8daff; 
            width: 100%;
            box-sizing: border-box;
            display: flex;
            align-items: center;
        }
        .help-icon { font-size: 20px; margin-right: 15px; color: #007bff; }
        .help-content b { color: #0056b3; background-color: rgba(0,123,255,0.1); padding: 2px 4px; border-radius: 3px; }
    </style>
</head>
<body>

    <div style="text-align: center; padding: 15px 10px; background-color: #333; margin-bottom: 20px;">
        <a href="index.html" style="color: white; text-decoration: none; margin: 0 15px; font-weight: bold;">ğŸ”„ íŒŒì¼ ì´ë¦„ ì¼ê´„ ë³€ê²½</a>
        <a href="editor.html" style="color: #ffcc80; text-decoration: none; margin: 0 15px; font-weight: bold;">ğŸ¨ ì‚¬ì§„ í¸ì§‘ & ë„ì¥ ì°ê¸°</a>
    </div>
    <h2>ë‚˜ë§Œì˜ ê³ í™”ì§ˆ ì›¹ ì‚¬ì§„ í¸ì§‘ íˆ´ ğŸ¨</h2>
    
    <div class="ui-wrapper">
        <div class="help-text">
            <div class="help-icon">ğŸ’¡</div>
            <div class="help-content">
                <b>ë§ˆìš°ìŠ¤ íœ </b>: ì´ë¯¸ì§€ í™•ëŒ€/ì¶•ì†Œ (Zoom) &nbsp;|&nbsp; 
                <b>Alt í‚¤ + ë“œë˜ê·¸</b>: í™”ë©´ ì´ë™ (Pan) &nbsp;|&nbsp; 
                <b>Backspace / Delete í‚¤</b>: ì„ íƒ ê°ì²´ ì‚­ì œ
            </div>
        </div>
    </div>

    <div class="ui-wrapper">
        <div class="toolbar">
            <div class="button-group">
                <input type="file" id="imageLoader" accept="image/*" title="ë°°ê²½ìœ¼ë¡œ ì“¸ ì›ë³¸ ì‚¬ì§„ ì„ íƒ" />
                <button id="btnRect">ğŸŸ¥ ë¹ˆ ì‚¬ê°í˜•</button>
                <button id="btnHollowCircle">â­• ë¹ˆ ì›</button>
                <button id="btnCircle">ğŸ”µ ê½‰ ì°¬ ì›</button>
                <button id="btnArrow">â†—ï¸ í™”ì‚´í‘œ</button>
                <button id="btnText">ğŸ“ í…ìŠ¤íŠ¸</button>
                <button id="btnDelete">ğŸ—‘ï¸ ì„ íƒ ì‚­ì œ</button>
                <button id="btnSave">ğŸ’¾ ê³ í™”ì§ˆ ì €ì¥</button>
            </div>
            
            <div>
                <div class="control-group">
                    <label>ğŸ¨ ìƒ‰ìƒ: <input type="color" id="colorPicker" value="#FF0000"></label>
                    <span style="margin: 0 10px; color:#ccc;">|</span>
                    <label>ğŸ“ ì„  ë‘ê»˜: <input type="range" id="lineWidth" min="1" max="50" value="10" title="ì„  ë‘ê»˜ ì¡°ì ˆ"></label>
                </div>
                
                <div class="control-group" style="background: #fff9e6; border-color: #ffecb5;">
                    <label>ğŸ˜€ ì´ëª¨ì§€: 
                        <select id="emojiSelect">
                            <option value="â­">â­ ë³„</option>
                            <option value="â¤ï¸">â¤ï¸ í•˜íŠ¸</option>
                            <option value="ğŸ‘">ğŸ‘ êµ¿ (ë”°ë´‰)</option>
                            <option value="ğŸ’¯">ğŸ’¯ êµ¿ (100ì )</option>
                            <option value="ğŸ’®">ğŸ’® êµ¿ (ì°¸ì˜í–ˆì–´ìš”)</option>
                            <option value="ğŸ‘Œ">ğŸ‘Œ ì˜¤ì¼€ì´ (ì†ëª¨ì–‘)</option>
                            <option value="ğŸ™†">ğŸ™† ì˜¤ì¼€ì´ (ì‚¬ëŒ)</option>
                            <option value="ğŸ†—">ğŸ†— ì˜¤ì¼€ì´ (ë§ˆí¬)</option>
                            <option value="ğŸ‘">ğŸ‘ ë°°ë“œ (ìš°ìš°~)</option>
                            <option value="âœ…">âœ… ì²´í¬ (ì •ìƒ)</option>
                            <option value="âŒ">âŒ ì—‘ìŠ¤í‘œ (ë¶ˆëŸ‰)</option>
                            <option value="â­•">â­• ë¹ˆ ë™ê·¸ë¼ë¯¸ (O)</option>
                            <option value="ğŸ‘ GOOD!">ğŸ‘ GOOD! (ê¸€ì)</option>
                            <option value="ğŸ‘ BAD...">ğŸ‘ BAD... (ê¸€ì)</option>
                            <option value="ì›ƒ">ì›ƒ (ì¡¸ë¼ë§¨)</option>
                            <option value="ì˜·">ì˜· (ë§Œì„¸ë§¨)</option>
                            <option value="ğŸƒ">ğŸƒ ë‹¬ë¦¬ëŠ” ì‚¬ëŒ</option>
                            <option value="â“">â“ ë¬¼ìŒí‘œ</option>
                            <option value="â—">â— ëŠë‚Œí‘œ</option>
                        </select>
                    </label>
                    <button id="btnEmoji">â• ë„£ê¸°</button>
                    <span style="margin: 0 10px; color:#ffc107;">|</span>
                    <input type="file" id="stickerLoader" accept="image/*" style="display: none;" />
                    <button id="btnSticker">ğŸŒŸ ë‚´ ìŠ¤í‹°ì»¤ ì¶”ê°€</button>
                </div>
            </div>
        </div>
    </div>

    <div class="canvas-container-wrapper">
        <canvas id="myCanvas" width="800" height="400"></canvas>
    </div>

    <script>
        if (typeof fabric !== 'undefined') {
            fabric.Text.prototype.textBaseline = 'bottom';
            fabric.IText.prototype.textBaseline = 'bottom';
            fabric.Object.prototype.cornerSize = 20;
            fabric.Object.prototype.transparentCorners = false;
            // íšŒì „ ì¡°ì ˆì (MTR)ì„ ì¢€ ë” ìœ„ë¡œ ì˜¬ë ¤ì„œ ì„ íƒí•˜ê¸° ì‰½ê²Œ í•¨
            fabric.Object.prototype.rotatingPointOffset = 40;
            // ê°ì²´ ì„ íƒ ì‹œ í…Œë‘ë¦¬ ìƒ‰ìƒ ë³€ê²½
            fabric.Object.prototype.borderColor = '#007bff';
            fabric.Object.prototype.cornerColor = '#007bff';
        }

        window.onload = function() {
            const canvas = new fabric.Canvas('myCanvas');
            const colorPicker = document.getElementById('colorPicker');
            const lineWidthSlider = document.getElementById('lineWidth');
            const emojiSelect = document.getElementById('emojiSelect');

            // 1. ë°°ê²½ ì‚¬ì§„ ë¶ˆëŸ¬ì˜¤ê¸°
            document.getElementById('imageLoader').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = function(event) {
                    const imgObj = new Image();
                    imgObj.src = event.target.result;
                    imgObj.onload = function() {
                        canvas.setWidth(this.width);
                        canvas.setHeight(this.height);
                        const image = new fabric.Image(imgObj);
                        canvas.setBackgroundImage(image, canvas.renderAll.bind(canvas), { scaleX: 1, scaleY: 1, originX: 'left', originY: 'top', left: 0, top: 0 });
                        canvas.setViewportTransform([1,0,0,1,0,0]);
                    };
                };
                reader.readAsDataURL(file);
            });

            // 2. ì¤Œ & íŒ¨ë‹ ê¸°ëŠ¥
            canvas.on('mouse:wheel', function(opt) {
                var delta = opt.e.deltaY;
                var zoom = canvas.getZoom();
                zoom *= 0.999 ** delta;
                if (zoom > 20) zoom = 20;
                if (zoom < 0.1) zoom = 0.1; 
                canvas.zoomToPoint({ x: opt.e.offsetX, y: opt.e.offsetY }, zoom);
                opt.e.preventDefault();
                opt.e.stopPropagation();
            });

            canvas.on('mouse:down', function(opt) {
                if (opt.e.altKey === true) {
                    this.isDragging = true;
                    this.selection = false;
                    this.lastPosX = opt.e.clientX;
                    this.lastPosY = opt.e.clientY;
                    canvas.defaultCursor = 'grabbing'; // ë“œë˜ê·¸ ì¤‘ ì»¤ì„œ ë³€ê²½
                }
            });

            canvas.on('mouse:move', function(opt) {
                if (this.isDragging) {
                    var vpt = this.viewportTransform;
                    vpt[4] += opt.e.clientX - this.lastPosX;
                    vpt[5] += opt.e.clientY - this.lastPosY;
                    this.requestRenderAll();
                    this.lastPosX = opt.e.clientX;
                    this.lastPosY = opt.e.clientY;
                }
            });

            canvas.on('mouse:up', function(opt) {
                if (this.isDragging) {
                    this.isDragging = false;
                    this.selection = true;
                    canvas.defaultCursor = 'default'; // ì»¤ì„œ ë³µêµ¬
                }
            });

            // 3. ë„í˜• ë° í…ìŠ¤íŠ¸ ì¶”ê°€
            document.getElementById('btnRect').addEventListener('click', function() {
                const rect = new fabric.Rect({ left: 100, top: 100, width: 300, height: 200, fill: 'transparent', stroke: colorPicker.value, strokeWidth: parseInt(lineWidthSlider.value), transparentCorners: false, strokeUniform: true });
                canvas.add(rect); canvas.setActiveObject(rect);
            });

            document.getElementById('btnHollowCircle').addEventListener('click', function() {
                const circle = new fabric.Circle({ left: 120, top: 120, radius: 150, fill: 'transparent', stroke: colorPicker.value, strokeWidth: parseInt(lineWidthSlider.value), transparentCorners: false, strokeUniform: true });
                canvas.add(circle); canvas.setActiveObject(circle);
            });

            document.getElementById('btnCircle').addEventListener('click', function() {
                const circle = new fabric.Circle({ left: 150, top: 150, radius: 100, fill: colorPicker.value, transparentCorners: false });
                canvas.add(circle); canvas.setActiveObject(circle);
            });

            document.getElementById('btnArrow').addEventListener('click', function() {
                const arrowPath = 'M 0 20 L 80 20 L 80 0 L 120 30 L 80 60 L 80 40 L 0 40 Z';
                const arrow = new fabric.Path(arrowPath, { left: 200, top: 200, fill: colorPicker.value, transparentCorners: false });
                canvas.add(arrow); canvas.setActiveObject(arrow);
            });

            document.getElementById('btnText').addEventListener('click', function() {
                const text = new fabric.IText('ë”ë¸”í´ë¦­í•´ì„œ ìˆ˜ì •', { left: 150, top: 50, fontFamily: 'sans-serif', fill: colorPicker.value, fontSize: 80 });
                canvas.add(text); canvas.setActiveObject(text);
            });

            document.getElementById('btnEmoji').addEventListener('click', function() {
                const emojiChar = emojiSelect.value;
                const emojiText = new fabric.Text(emojiChar, { left: 200, top: 200, fontSize: 150, transparentCorners: false });
                canvas.add(emojiText); canvas.setActiveObject(emojiText);
            });

            document.getElementById('btnSticker').addEventListener('click', function() { document.getElementById('stickerLoader').click(); });
            document.getElementById('stickerLoader').addEventListener('change', function(e) {
                const file = e.target.files[0]; if (!file) return;
                const reader = new FileReader();
                reader.onload = function(event) {
                    const imgObj = new Image(); imgObj.src = event.target.result;
                    imgObj.onload = function() {
                        const sticker = new fabric.Image(imgObj);
                        const maxSize = canvas.width * 0.2; let scale = 1;
                        if (sticker.width > maxSize) scale = maxSize / sticker.width;
                        sticker.set({ scaleX: scale, scaleY: scale, transparentCorners: false });
                        canvas.add(sticker); canvas.viewportCenterObject(sticker); canvas.setActiveObject(sticker);
                        e.target.value = ''; 
                    };
                }; reader.readAsDataURL(file);
            });

            // 4. ì‹¤ì‹œê°„ ì†ì„± ë³€ê²½
            colorPicker.addEventListener('input', function(e) {
                const obj = canvas.getActiveObject();
                if (obj) {
                    if (obj.type === 'i-text' || obj.type === 'text' || obj.fill !== 'transparent') obj.set('fill', e.target.value);
                    if (obj.stroke && obj.fill === 'transparent') obj.set('stroke', e.target.value);
                    canvas.renderAll();
                }
            });

            lineWidthSlider.addEventListener('input', function(e) {
                const obj = canvas.getActiveObject();
                if (obj && obj.fill === 'transparent') { obj.set('strokeWidth', parseInt(e.target.value, 10)); canvas.renderAll(); }
            });

            // 5. ì‚­ì œ ê¸°ëŠ¥
            document.getElementById('btnDelete').addEventListener('click', function() {
                const activeObject = canvas.getActiveObject();
                if (activeObject) canvas.remove(activeObject);
            });
            window.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' || e.key === 'Delete') {
                    const activeObject = canvas.getActiveObject();
                    if (activeObject) {
                        if (activeObject.isEditing) return; 
                        canvas.remove(activeObject);
                        e.preventDefault(); 
                    }
                }
            });

            // 7. ê³ í™”ì§ˆ ì €ì¥
            document.getElementById('btnSave').addEventListener('click', function() {
                canvas.discardActiveObject(); canvas.renderAll();
                const currentVpt = canvas.viewportTransform.slice();
                canvas.setViewportTransform([1,0,0,1,0,0]);
                const dataURL = canvas.toDataURL({ format: 'png', quality: 1.0, enableRetinaScaling: true });
                canvas.setViewportTransform(currentVpt);
                const link = document.createElement('a');
                link.download = 'ë‚˜ë§Œì˜_ê³ í™”ì§ˆ_í¸ì§‘ì‚¬ì§„.png';
                link.href = dataURL; document.body.appendChild(link);
                link.click(); document.body.removeChild(link);
            });
        };
    </script>
</body>
</html>
